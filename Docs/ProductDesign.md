# Swipop Create 产品设计文档

## 核心理念

Swipop Create 是一个类似 Cursor/Copilot 的 AI 辅助代码创作工具，用户通过对话驱动 AI 生成 HTML/CSS/JavaScript 三件套作品。

---

## 架构设计

### 五子页面结构

创作页面分为五个子页面：

1. **Chat** - 与 AI 对话，驱动代码生成（核心入口）
2. **Preview** - 实时预览作品效果
3. **HTML** - HTML 源码查看与手动编辑
4. **CSS** - CSS 源码查看与手动编辑
5. **JavaScript** - JS 源码查看与手动编辑

### 工作区概念

- 一个作品 = 一个对话 = 一个工作区
- 对话只能编辑对应的作品，不能跨作品操作
- 简化管理，避免对话历史的复杂性

---

## AI 工具调用

AI 通过 Function Calling 机制执行以下工具：

### 代码编辑工具
- 编辑 HTML 文档
- 编辑 CSS 文档
- 编辑 JavaScript 文档

### 元数据工具
- 更新作品标题
- 更新作品描述
- 更新作品标签

### 文件上传工具

**媒体上传（转 URL）**
- 支持：图片、音频、视频
- 大小限制：10MB 以内
- 用途：生成公开 URL，供三件套中引用
- 类似图床功能

**文档上传（上下文）**
- 支持：Word、Markdown、TXT、代码文件
- 用途：直接读取内容，作为 AI 上下文
- 帮助 AI 理解用户需求

---

## 作品生命周期

### 自动保存
- 只要三件套有内容，作品立即保存
- 空作品不会被创建
- 实时保存，防止数据丢失
- 提供手动保存按钮（心理安慰作用）

### 发布状态
- **草稿**：仅自己可见
- **公开**：所有人可见
- 用户有权在发布前打磨作品

### 持续迭代
- 作品可以反复修改
- 保留同一作品的点赞、收藏、浏览数据
- 代码天然适合迭代，不同于视频

---

## 作品 API

作品可以调用平台 API，实现自定义 UI：

### 可用接口
- `currentUser` - 当前观看者信息
- `likeCount` - 点赞数
- `collectCount` - 收藏数
- `viewCount` - 浏览数
- `like()` - 触发点赞
- `collect()` - 触发收藏

### 应用场景
- 作品内自定义点赞动画
- 显示欢迎语：「欢迎，XXX」
- 作品内展示互动数据
- 减少对平台 UI 的依赖

---

## 后端架构

### API Key 管理
- 前端不存储任何 API Key
- 后端管理大量低余额 Key（数百至数千个）
- Key 用完即删，不充值
- 随机选择 Key，自动轮换

### Key 失效处理
- 401/402/403：立即删除 Key，切换下一个
- 429 限速：不删除，仅切换下一个

### 请求代理
- 所有 AI 请求通过后端代理
- 仅支持 Streaming 响应
- 用户无请求数量限制

### 会话日志
- 记录每次完整对话
- 自然包含 Key 使用情况
- 便于问题追溯

---

## 上下文管理

### 问题
- 对话累积导致 token 超限
- 模型上下文窗口大小固定

### 解决方案
- 阶段性对话摘要
- 滑动窗口机制
- 类似 Cursor/Copilot 的做法

---

## 用户认证

- 调用 Edge Function 必须登录
- JWT 验证确保安全
- 防止未授权访问和滥用

---

## 设计原则

1. **简单优先** - 一个作品对应一个对话，避免复杂关联
2. **数据不丢失** - 有内容即保存，实时持久化
3. **用户掌控** - 草稿/公开状态用户决定
4. **AI 驱动** - 对话为主，手动编辑为辅
5. **开放能力** - 作品可调用平台 API

